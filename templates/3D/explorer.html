<html>
    <head>
    <title>DIM CREATOR</title>
    <meta charset="utf-8">

    <meta name="viewport" content="user-scalable=no">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">

    <script src="/static/back/vendors/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/static/back/js/app.min.js"></script>

    <link href="/static/back/vendors/bower_components/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="/static/back/vendors/bower_components/sweetalert2/dist/sweetalert2.min.js"></script>
    
    <link href="/static/back/vendors/bower_components/animate.css/animate.min.css" rel="stylesheet">
    
    <link href="/static/back/css/app.css" rel="stylesheet">
    <link href="/static/back/vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/static/favicon.ico"/>


    <script type='text/javascript' src='/static/3D/js/babylon.custom.js'></script>
    <script type='text/javascript' src='/static/3D/js/inspector.bundle.min.js'></script>
    

    <style>

            .container-ex {
                width:100%;
                padding-left:15px;
                padding-right:15px;
            }

            babylon {
                width: 100%;
                height: 100%;
            }

            html, body, canvas {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
            touch-action: auto;  /*这行不能省！！！！！！！！！！！！！！！*/
            }

    
    </style>
    </head>
    <body style="height: 100%">
    
        <canvas id='canvas'></canvas>
        <script language="Javascript">
            document.oncontextmenu = function(){return false;}
        </script>
        <script type='text/javascript'>
            var canvas = document.getElementById('canvas');
            var engine = new BABYLON.Engine(canvas, true);
            var newScene = new BABYLON.Scene(engine);

            BABYLON.SceneLoader.Load('/media/Warehouse/{{workid}}/', 'model.babylon', engine, function (newScene) {

                // Attach camera to canvas inputs
                if (!newScene.activeCamera || newScene.lights.length === 0) {
                    newScene.createDefaultCameraOrLight(true);
                    // Enable camera's behaviors
                    newScene.activeCamera.useFramingBehavior = true;
    
                    var framingBehavior = newScene.activeCamera.getBehaviorByName('Framing');
                    framingBehavior.framingTime = 0;
                    framingBehavior.elevationReturnTime = -1;
    
                    if (newScene.meshes.length) {
                        var worldExtends = newScene.getWorldExtends();
                        newScene.activeCamera.lowerRadiusLimit = null;
                        framingBehavior.zoomOnBoundingInfo(worldExtends.min, worldExtends.max);
                    }
    
                    newScene.activeCamera.pinchPrecision = 200 / newScene.activeCamera.radius;
                    newScene.activeCamera.upperRadiusLimit = 5 * newScene.activeCamera.radius;
    
                    newScene.activeCamera.wheelDeltaPercentage = 0.01;
                    newScene.activeCamera.pinchDeltaPercentage = 0.01;
                }
    
                newScene.activeCamera.attachControl(canvas);
    
                var keyboard = newScene.activeCamera.inputs.attached.keyboard;
                keyboard.keysUp.push(87);
                keyboard.keysDown.push(83);
                keyboard.keysLeft.push(65);
                keyboard.keysRight.push(68);
    
                engine.runRenderLoop(function() {
                    newScene.render();
                });
    
                window.addEventListener('resize', function () {
                    engine.resize();
                });
    

            });
        </script>
    
       <!-- <div class="loader" id="loader" style="height:100%;width:100%;background-color:beige"><p id="progress"></p></div> -->

        <nav class="navbar navbar-explorer navbar-fixed-bottom">
            <div class="container-ex">
                <button class="btn btn-default btn--icon " data-mae-action="fullscreen" ><i class="zmdi zmdi-fullscreen"></i></button>
                <button class="btn btn-default btn--icon" onclick="reset()" ><i class="zmdi zmdi-refresh"></i></button>
                <button class="btn btn-default btn--icon" onclick="tutorial();" ><i class="zmdi zmdi-help-outline"></i></button>
                <button class="btn btn-default btn--icon pull-right" onclick="share()" ><i class="zmdi zmdi-share"></i></button>
            </div>
        </nav> 


        

        <script>
            function reset(){
                window.location.reload();
            }
            function tutorial(){
                swal({
                    showCloseButton: true,
                    showCancelButton: false,
                    showConfirmButton: false,
                    title: '操作向导',
                    html:
                        '<div class="col-xs-6" style="margin-bottom: 30px;"><i class="zmdi zmdi-3d-rotation" style="font-size: 50px"></i></br>  <h4 style="color:#595959">环游</h4>鼠标左键  单指触摸</div>'+
                        '<div class="col-xs-6" style="margin-bottom: 30px;"><i class="zmdi zmdi-zoom-in" style="font-size: 50px"></i></br>  <h4 style="color:#595959">缩放</h4>鼠标滚轮  双指触摸</div>'+
                        '<div class="col-xs-6" style="margin-bottom: 30px;"><i class="zmdi zmdi-arrows" style="font-size: 50px"></i></br>  <h4 style="color:#595959">平移</h4> 鼠标右键</div>',                        
                });
            };
            function share(){
                swal({
                    showCloseButton: true,
                    title: "分享",
                    html:                        
                    '<div class="col-xs-12" style="margin-bottom: 10px;"><img src="../media/Warehouse/{{workid}}/qrcode.jpg" style="height: 200px;"></img></br>',
                    confirmButtonText: "保存二维码"
                }).then(function(){
                    
                        download('../media/Warehouse/{{workid}}/qrcode.jpg', 'qrcode'),
                        "success"
                    
                });
            };
            function download(href, title) {
                const a = document.createElement('a');
                a.setAttribute('href', href);
                a.setAttribute('download', title);
                a.click();
            }
        </script>












    </body>
</html>